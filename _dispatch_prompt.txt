# Spec-Driven Implementation

## CRITICAL: TRUST THE SPEC

The specification below is COMPLETE. Do not:
- Read README, ARCHITECTURE, or documentation files
- Search for patterns or conventions in the codebase
- Explore directory structures
- Read files unrelated to your implementation

Only read files that:
1. You need to import from (check the target path's neighbors)
2. Contain types/classes referenced in the interface

The spec tells you exactly what to build. Trust it.

## CIRCUIT BREAKER

If you have made 8+ file reads without writing any code, STOP.
You are exploring instead of implementing. The spec is complete.
Write the implementation now with what you know.

## THE SPECIFICATION

# Specification: P1MissingPatterns
Tier: FEATURE

## Description
Add missing regex patterns to AnswerEngine for EEO, salary, language, and preference questions.

## Interface
- `AnswerEngine._build_patterns()` - Add new pattern tuples for missing categories

## Must Do
- Add EEO/demographic patterns to match questions like:
- "gender", "sex", "gender identity" → dropdowns.gender
- "race", "ethnicity", "racial background" → dropdowns.race, dropdowns.ethnicity
- "veteran", "veteran status", "protected veteran" → dropdowns.veteran_status
- "disability", "disability status", "accommodation" → dropdowns.disability_status
- Add salary patterns:
- "salary expectation", "desired salary", "expected compensation" → salary.expected
- "minimum salary", "salary requirement" → salary.minimum
- "hourly rate", "rate expectation" → salary.hourly_rate
- Add language patterns:
- "english proficiency", "english fluency", "language proficiency" → languages.english
- Add preference patterns:
- "notice period", "how much notice", "when can you start" → preferences.notice_period
- "available to start", "start date", "earliest start" → preferences.available_start
- "work type", "remote/hybrid/onsite" → preferences.work_type
- Add select/dropdown handling in `_format_answer()`:
- If field_type == "select", return str(value) as-is

## Must Not Do
- Modify answers.yaml (patterns already exist there)
- Change existing patterns
- Modify test files

## Validation
- Tests: pytest tests/ -k "answer" -v

## Target Path
src/agent/answer_engine.py

## YOUR TASK

**Tier: FEATURE** - Standard feature implementation.
- Full behavior test coverage
- All edge cases must be tested
- Contract tests for public interfaces

### Step 1: Implement the Interface

Implementation location: `src/agent/answer_engine.py`

Implementation Rules:
1. Follow interface signatures EXACTLY as specified
2. Handle all edge cases as specified
3. Ensure preconditions are checked
4. Ensure postconditions are satisfied
5. Respect all 'Must Not Do' constraints

### Step 2: Write Tests

Test file location: `tests/test_p1missingpatterns.py`

After implementing, write tests that verify contract and behavior:

**Must Do Tests:**
- Write one test for each item in the 'Must Do' section
- Tests should verify the behavior/contract, not implementation details

Test Code Requirements:
- Use pytest fixtures for shared setup
- Include full type hints
- Use descriptive test names
- Keep tests focused and independent

### Step 3: Validate

Run validation: `pytest tests/ -k "answer" -v`

Iterate until all tests pass.
Maximum iterations: 5

Write clean, scalable, modular, efficient code. Follow single responsibility principle. Do not repeat yourself. Use consistent naming conventions. No unnecessary comments.