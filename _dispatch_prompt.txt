# Spec-Driven Implementation

## CRITICAL: TRUST THE SPEC

The specification below is COMPLETE. Do not:
- Read README, ARCHITECTURE, or documentation files
- Search for patterns or conventions in the codebase
- Explore directory structures
- Read files unrelated to your implementation

Only read files that:
1. You need to import from (check the target path's neighbors)
2. Contain types/classes referenced in the interface

The spec tells you exactly what to build. Trust it.

## CIRCUIT BREAKER

If you have made 8+ file reads without writing any code, STOP.
You are exploring instead of implementing. The spec is complete.
Write the implementation now with what you know.

## THE SPECIFICATION

# Specification: FailureLoggerIntegration
Tier: FEATURE

## Description
Wire FailureLogger into the form processing components to capture failures at runtime.

## Must Do
- Import FailureLogger at module level in each file
- Create single FailureLogger instance per module (module-level constant)
- Pass job context (job_url, job_title, company) through to logging calls - may need to add parameters or use class state
- Use ISO timestamps via datetime.now().isoformat()
- Capture page_snapshot as page.content() when logging (truncate to 50KB if larger)
- Import and use FormProcessorStuckDetection, call record_page() on each iteration, check_stuck() to detect
- When stuck detected: log failure, return early from processing loop

## Must Not Do
- Don't change existing method signatures if avoidable - add optional params or use **kwargs
- Don't break existing tests - run pytest after changes
- Don't log on every iteration - only on actual failures

## Edge Cases
- Job context not available → use empty strings for job_url/job_title/company
- page.content() fails → set page_snapshot to None
- FailureLogger.log() raises → catch and continue (logging shouldn't break form filling)

## Validation
- Tests: pytest tests/agent/test_answer_engine.py tests/agent/test_form_processor.py -v --tb=short

## Target Path
Multiple files: src/agent/answer_engine.py, src/agent/form_processor.py

## YOUR TASK

**Tier: FEATURE** - Standard feature implementation.
- Full behavior test coverage
- All edge cases must be tested
- Contract tests for public interfaces

### Step 1: Implement the Interface

Implementation location: `Multiple files: src/agent/answer_engine.py, src/agent/form_processor.py`

Implementation Rules:
1. Follow interface signatures EXACTLY as specified
2. Handle all edge cases as specified
3. Ensure preconditions are checked
4. Ensure postconditions are satisfied
5. Respect all 'Must Not Do' constraints

### Step 2: Write Tests

Test file location: `tests/test_failureloggerintegration.py`

After implementing, write tests that verify contract and behavior:

**Must Do Tests:**
- Write one test for each item in the 'Must Do' section
- Tests should verify the behavior/contract, not implementation details

**Edge Case Tests:**
- Write one test for each edge case specified

Test Code Requirements:
- Use pytest fixtures for shared setup
- Include full type hints
- Use descriptive test names
- Keep tests focused and independent

### Step 3: Validate

Run validation: `pytest tests/agent/test_answer_engine.py tests/agent/test_form_processor.py -v --tb=short`

Iterate until all tests pass.
Maximum iterations: 5

Write clean, scalable, modular, efficient code. Follow single responsibility principle. Do not repeat yourself. Use consistent naming conventions. No unnecessary comments.